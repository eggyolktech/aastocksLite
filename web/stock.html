
<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="robots" content="noindex, nofollow">
  <meta name="googlebot" content="noindex, nofollow">
  <script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.js"></script>
  
  <script src="./js/common.js"></script>
  <script src="./js/data.js"></script>

  <style type="text/css">
  
    body {  
        font-family: Arial;
        font-size: 13px;
    }

    a {
        margin-left: 7px;
    }

    /* unvisited link */
    a:link {
        color: green;
    }

    /* visited link */
    a:visited {
        color: green;
    }

    /* mouse over link */
    a:hover {
        color: red;
    }

    /* selected link */
    a:active {
        color: yellow;
    }
    
  </style>

  <title>Stock Chart Chart</title>


<script type='text/javascript'>//<![CDATA[

var main = "http://charts.aastocks.com/servlet/Charts?fontsize=12&15MinDelay=F&lang=1&titlestyle=1&vol=1&chart=left&type=1";

var indicator = "&Indicator=1&indpara1=4&indpara2=6&indpara3=14&indpara4=27&indpara5=40&indpara6=52"
var subchart = "&subChart1=3&ref1para1=12&ref1para2=26&ref1para3=9" 
            + "&subChart2=7&ref2para1=16&ref2para2=8&ref2para3=8" 
            + "&subChart3=2&ref3para1=16&ref3para2=0&ref3para3=0"; 
var subchart_coldfeet = "&subChart4=2&ref4para1=3&ref4para2=0&ref4para3=0";
var scheme = "&scheme=1&com=100&chartwidth=1073&chartheight=750";
var scheme_single = "&scheme=1&com=100&chartwidth=1073&chartheight=950";
var period = "&period=" + 6;
var id = "&stockid=";
var DEFAULT_CODE = "110000";

var url = main + indicator + subchart + scheme + period + id
var url_ind = main + indicator + subchart + subchart_coldfeet + scheme_single + period + id

function displaySingleChart(code){

    if (code) {
        
        $("#tfBar").hide();
        $("#inputCode").val(code);
        
        var images = $.map(tfPeriod.list, function ( item, i) {        
            var regex = /(period=)\d+/;
            return $('<img>', { id: 'theImg' + code, src: url_ind.replace(regex,"period=" + item.period) + code });
        }); 

        $("#chartDiv").empty().append(images);
    }
}

function createDropdownMenu(drpId, drpData, drpDesc, drpToSkipReset ) {

    var options = $.map(drpData.list, function ( item, i) {
        return $('<option>', { text: item.label, value: item.code });
    });
    
    $("#" + drpId).empty()
        .append($('<option>', { text: drpDesc, value: "" }))
        .append($('<option>', { text: "ALL", value: "ALL" }))
        .append(options);  

    $(document).on('change','#' + drpId ,function(){
        
        var code = this.value;
        
        if (code == "") {
            // Nill case
            return;
        } else if (code == "ALL") {
            // List all cases
            $("#tfBar").show();
            $("#inputCode").val("");
            
            var images = $.map(drpData.list, function ( item, i) {
                return $('<img>', { id: 'theImg' + item.code, src: url + item.code });
            });
            
            $("#chartDiv").empty().append(images);    
  
        } else {
            // List Individual cases
            displaySingleChart(code);
        }
        
        if (!drpToSkipReset) {
            $('select[id^="drp"]' + ':not(#' + drpId + ')').prop('selectedIndex',0);
        } else {
            $('select[id^="drp"]' + ':not(#' + drpId + ',#' + drpToSkipReset + ')').prop('selectedIndex',0);
        }  
    });
}

$(window).load(function(){

    //////// Input Code Box
    $("#inputCode").focus();
    
    $(document).keypress(function(e) {
        
        // Enter Key
        if (e.which == 13) {
            if ($("#inputCode").val() == "") {
                $("#inputCode").val(DEFAULT_CODE);
            } 
            
            $('select[id^="drp"]').prop('selectedIndex',0);
           
            // List Individual cases
            displaySingleChart($("#inputCode").val());
            $("#inputCode").select();
        } 
    });

    //////// Index Dropdown List
    createDropdownMenu("drpIndex", indexData, "指數");
        
    //////// ETF Dropdown List
    createDropdownMenu("drpETF", etfData, "ETF");
 
    //////// Bluechip Dropdown List
    createDropdownMenu("drpBluechip", blueChipData, "指數成分股");
    
    //////// Industry Dropdown List
    options = $.map(industryData.list, function (item, i) {
        return $('<option>', { text: item.label, value: item.code });
    }); 

    $("#drpIndustry").empty()
        .append($('<option>', { text: "行業分類", value: "" }))
        .append(options);      
        
    $(document).on('change','#drpIndustry' ,function(){
        
        var code = this.value;
        
        if (code == "") {
            // Nill case
        } else {
            // Generate Sub Industry List  
            var filteredIndustry = $(industryData.list).filter(function( idx ) {
                return industryData.list[idx].code == code;
            }); 
            
            //////// Create Industry Sub Dropdown List
            createDropdownMenu("drpIndustrySub", filteredIndustry[0], "請選擇", "drpIndustry");            
        }
    });
    
    //////// Time Frame Toggle (for ALL Case)
    var links = $.map(tfPeriod.list, function ( item, i)  {        
        return $('<a>', { id: 'tf_' + item.period, href: "#", text: item.timeframe });
    }); 
    $("#tfBar").empty().append(links);
 
    $(document).on('click', 'a[id^="tf"]', function(){        
        var new_period = this.id.replace("tf_","");
        $('img[id^="theImg"]').filter(
            function(){
                var regex = /(period=)\d+/;
                var src = $(this).attr("src").replace(regex,"period=" + new_period);
                $(this).attr("src", src);
        });
    }); 

}); //]]> 

</script>

  
</head>

<body>
    <table>
        <tr>
            <td>
                <input type="text" id="inputCode" size="10" style="font-size: 12px;">
            </td>            
            <td><select id="drpIndex"></select></td>
            <td><select id="drpETF"></select></td>
            <td><select id="drpBluechip"></select></td>
            <td><select id="drpIndustry"></select></td>
            <td><select id="drpIndustrySub"></select></td>
            <td>
                <div id="tfBar">
                    <!--a id="tfM" href="#">M</a>
                    <a id="tfW" href="#">W</a>
                    <a id="tfD" href="#">D</a>
                    <a id="tfh" href="#">h</a>
                    <a id="tfm" href="#">m</-->
                </div>
            </td>
        </tr>
    </table>
    
    
    <p id="spacer"/>
    <!--h1 id="answer"></h1-->

    <div id="chartDiv"><img src="./images/enter.png" width="21"/></div>

</body>

</html>

